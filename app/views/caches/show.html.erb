<%= render "/shared/back" %>
<div id="sm-map-container">
  <%= render 'map' %>
  <div id="sm-static"></div>
</div>

<div class="container">
  <div class="cache-photo-grid mt-3">
    <% if @cache.photos.attached? %>
      <% if @cache.photos.count == 1 %>
        <div class="p1-cache-show">
          <%= cl_image_tag @cache.photos.first.key %>
        </div>
      <% elsif @cache.photos.count == 2 %>
        <div class="p1-cache-show">
          <%= cl_image_tag @cache.photos.first.key %>
        </div>
          <div class="p2-cache-show">
            <%= cl_image_tag @cache.photos.last.key %>
          </div>
      <% else %>
        <div class="p1-cache-show">
          <%= cl_image_tag @cache.photos.first.key %>
        </div>
          <div class="p2-cache-show">
            <%= cl_image_tag @cache.photos[1].key %>
          </div>
          <div class="p3-cache-show">
            <%= cl_image_tag @cache.photos.last.key %>
          </div>
      <% end %>
    <% elsif @cache.seed_photo %>
      <div class="p1-cache-show-seed">
        <%= image_tag @cache.seed_photo %>
      </div>
    <% else %>
      <p>No uploaded photos</p>
    <% end %>
  </div>

  <div class="d-flex m-3 px-3 justify-content-between">
    <div class="text-align-center">
      <h2 class="text-success"><%= @cache.title %></h1>
    </div>

    <div data-controller="toggle-favorite">
      <a href="/caches/<%= @cache.id %>/toggle_favorite"
        data-turbo-method="post"
        tabindex="0"
        role="button"
        data-bs-toggle="popover"
        data-bs-trigger="manual"
        data-bs-placement="left"
        data-bs-html="true"
        data-bs-content="Added!"
        data-bs-custom-class="custom-popover"
        data-toggle-favorite-target="popoverLink">
        <i id="heart" data-toggle-favorite-target="link" data-action="click->toggle-favorite#toggleIconFill" class="<%= current_user.favorited?(@cache) ? 'fa-solid fa-heart-circle-minus fa-2xl' : 'fa-solid fa-heart-circle-plus fa-2xl' %>"></i>
      </a>
    </div>
  </div>

      <% if @cache.species.present? %>
        <div class="container">
          <% @cache.species.each do |s| %>
            <%= link_to s.name, species_path(s), class: "btn btn-secondary" %>
          <% end %>
        </div>
      <% end %>

  <div class="row">
    <div class="col-6">
      <div class="card mb-3">
        <%= image_tag @cache.seed_photo %>
        <div class="card-body">
          <h5 class="card-title">@<%= @cache.user.username %></h5>
          <p class="card-text"><%= @cache.description %></p>
          <p class="card-text"><small class="text-muted"><%= @cache.found_on.strftime("%b %d, %Y") %></small></p>
        </div>
      </div>
    </div>
  </div>

  </div>
</div>
